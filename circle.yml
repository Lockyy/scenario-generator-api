machine:
  services:
    - docker

dependencies:
  override:
    - if [[ -e ~/docker/image.tar ]]; then docker load -i ~/docker/image.tar; fi

    - docker info
    - mv Dockerfile.development Dockerfile
    - docker build -t codelitt/fletcher-ruby .

    - pwd

    - bundle
    - cd client && npm install && NODE_ENV=production $(npm bin)/webpack --config webpack.rails.config.js

    - mkdir -p ~/docker; docker save codelitt/fletcher-ruby > ~/docker/image.tar
test:
  override:
    - bundle exec rspec